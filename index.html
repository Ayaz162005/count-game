<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Catch The Duck</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tone/14.7.77/Tone.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.9.2/dist/confetti.browser.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Fredoka+One&family=Inter:wght@400;500;700&display=swap"
        rel="stylesheet">
    <style>
        :root {
            --bg-primary: #eff6ff;
            /* blue-50 */
            --bg-secondary: #ffffff;
            --text-primary: #1e3a8a;
            /* blue-900 */
            --text-secondary: #60a5fa;
            /* blue-400 */
            --accent-color: #f59e0b;
            /* amber-500 */
            --accent-hover: #f59e0b;
            --progress-bar-bg: #dbeafe;
            /* blue-100 */
            --water-color: #38bdf8;
            /* sky-400 */
        }

        .theme-dark {
            --bg-primary: #1e293b;
            /* slate-800 */
            --bg-secondary: #334155;
            /* slate-700 */
            --text-primary: #f1f5f9;
            /* slate-100 */
            --text-secondary: #94a3b8;
            /* slate-400 */
            --accent-color: #f59e0b;
            /* amber-500 */
            --accent-hover: #fbbf24;
            /* amber-400 */
            --progress-bar-bg: #475569;
            /* slate-600 */
            --water-color: #0369a1;
            /* sky-700 */
        }

        .theme-sunset {
            --bg-primary: #fff7ed;
            /* orange-50 */
            --bg-secondary: #ffffff;
            --text-primary: #7c2d12;
            /* orange-900 */
            --text-secondary: #fb923c;
            /* orange-400 */
            --accent-color: #f97316;
            /* orange-500 */
            --accent-hover: #ea580c;
            /* orange-600 */
            --progress-bar-bg: #fed7aa;
            /* orange-200 */
            --water-color: #f97316;
            /* orange-500 */
        }

        body {
            font-family: 'Inter', sans-serif;
            touch-action: manipulation;
            background-color: var(--bg-primary);
            color: var(--text-primary);
            transition: background-color 0.3s, color 0.3s;
            overflow-x: hidden;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='100' height='100' viewBox='0 0 100 100'%3E%3Cg fill-rule='evenodd'%3E%3Cg fill='%2360a5fa' fill-opacity='0.1'%3E%3Cpath opacity='.5' d='M96 95h4v1h-4v4h-1v-4h-9v4h-1v-4h-9v4h-1v-4h-9v4h-1v-4h-9v4h-1v-4h-9v4h-1v-4h-9v4h-1v-4h-9v4h-1v-4h-9v4h-1v-4H0v-1h15v-9H0v-1h15v-9H0v-1h15v-9H0v-1h15v-9H0v-1h15v-9H0v-1h15v-9H0v-1h15v-9H0v-1h15v-9H0v-1h15V0h1v15h9V0h1v15h9V0h1v15h9V0h1v15h9V0h1v15h9V0h1v15h9V0h1v15h9V0h1v15h9V0h1v15h4v1h-4v9h4v1h-4v9h4v1h-4v9h4v1h-4v9h4v1h-4v9h4v1h-4v9h4v1h-4v9h4v1h-4v9zm-1 0v-9h-9v9h9zm-10 0v-9h-9v9h9zm-10 0v-9h-9v9h9zm-10 0v-9h-9v9h9zm-10 0v-9h-9v9h9zm-10 0v-9h-9v9h9zm-10 0v-9h-9v9h9zm-10 0v-9h-9v9h9zm-9-10h9v-9h-9v9zm10 0h9v-9h-9v9zm10 0h9v-9h-9v9zm10 0h9v-9h-9v9zm10 0h9v-9h-9v9zm10 0h9v-9h-9v9zm10 0h9v-9h-9v9zm10 0h9v-9h-9v9zm9-10v-9h-9v9h9zm-10 0v-9h-9v9h9zm-10 0v-9h-9v9h9zm-10 0v-9h-9v9h9zm-10 0v-9h-9v9h9zm-10 0v-9h-9v9h9zm-10 0v-9h-9v9h9zm-10 0v-9h-9v9h9zm-9-10h9v-9h-9v9zm10 0h9v-9h-9v9zm10 0h9v-9h-9v9zm10 0h9v-9h-9v9zm10 0h9v-9h-9v9zm10 0h9v-9h-9v9zm10 0h9v-9h-9v9zm10 0h9v-9h-9v9zm9-10v-9h-9v9h9zm-10 0v-9h-9v9h9zm-10 0v-9h-9v9h9zm-10 0v-9h-9v9h9zm-10 0v-9h-9v9h9zm-10 0v-9h-9v9h9zm-10 0v-9h-9v9h9zm-10 0v-9h-9v9h9zm-9-10h9v-9h-9v9zm10 0h9v-9h-9v9zm10 0h9v-9h-9v9zm10 0h9v-9h-9v9zm10 0h9v-9h-9v9zm10 0h9v-9h-9v9zm10 0h9v-9h-9v9zm10 0h9v-9h-9v9zm9-10v-9h-9v9h9zm-10 0v-9h-9v9h9zm-10 0v-9h-9v9h9zm-10 0v-9h-9v9h9zm-10 0v-9h-9v9h9zm-10 0v-9h-9v9h9zm-10 0v-9h-9v9h9zm-10 0v-9h-9v9h9zm-9-10h9v-9h-9v9zm10 0h9v-9h-9v9zm10 0h9v-9h-9v9zm10 0h9v-9h-9v9zm10 0h9v-9h-9v9zm10 0h9v-9h-9v9zm10 0h9v-9h-9v9zm10 0h9v-9h-9v9z'/%3E%3Cpath d='M6 5V0h1v5h4V0h1v5h4V0h1v5h4V0h1v5h4V0h1v5h4V0h1v5h4V0h1v5h4V0h1v5h4V0h1v5h4V0h1v5h4V0h1v5h5v1h-5v4h5v1h-5v4h5v1h-5v4h5v1h-5v4h5v1h-5v4h5v1h-5v4h5v1h-5v4h5v1h-5v4h5v1h-5v4h5v1h-5v4h5v1h-5v4h-1v-4h-4v4h-1v-4h-4v4h-1v-4h-4v4h-1v-4h-4v4h-1v-4h-4v4h-1v-4h-4v4h-1v-4h-4v4h-1v-4h-4v4H0v-1h4v-4H0v-1h4v-4H0v-1h4v-4H0v-1h4v-4H0v-1h4v-4H0v-1h4v-4H0v-1h4v-4H0v-1h4v-4H0v-1h4v-4H0v-1h4v-4H0V5h6z'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E");
        }

        .panel {
            background-color: var(--bg-secondary);
            transition: background-color 0.3s;
        }

        .btn {
            transition: all 0.2s ease-in-out;
        }

        .btn:hover:not(:disabled) {
            transform: translateY(-3px) scale(1.05);
            box-shadow: 0 6px 15px rgba(0, 0, 0, 0.15);
        }

        .btn:active:not(:disabled) {
            transform: translateY(0px) scale(1);
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.1);
        }

        .modal-backdrop {
            background-color: rgba(0, 0, 0, 0.5);
        }

        h1,
        h2,
        h3 {
            font-family: 'Fredoka One', cursive;
        }

        .duck {
            display: inline-block;
            width: 44px;
            height: 44px;
            background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 64 64" style="enable-background:new 0 0 64 64" xml:space="preserve"><path style="fill:%23262626" d="M45.685 8.545c-.398-.339-1.27-.747-2.638.291-1.6 1.222-2.095 3.045-1.387 5.14.262.766.921 1.28 1.736 1.348.058.01.107.01.165.01.747 0 1.435-.417 1.785-1.086.911-1.717 1.619-4.626.339-5.703zm-2.046 4.801-.136.01c-.659-1.93.378-2.716.718-2.977.087-.068.155-.116.223-.155.048.591-.156 1.89-.805 3.122zm-2.997 36.378c-1.668 3.191-6.915 5.557-11.958 5.412-8.593-.272-16.041-4.82-16.962-10.358-.048-.291.029-.388.058-.427.592-.698 3.559-.727 6.43-.756.999-.01 2.075-.019 3.181-.058 5.266-.155 7.875-1.881 10.193-3.404a27.27 27.27 0 0 1 1.532-.98l-.97-1.678c-.553.32-1.086.669-1.639 1.038-2.192 1.445-4.461 2.948-9.175 3.084-1.096.039-2.153.048-3.142.058-4.054.039-6.731.068-7.894 1.455-.31.369-.65 1.018-.485 1.988 1.067 6.411 9.33 11.677 18.805 11.977h.504c4.869 0 11.017-2.202 13.238-6.449l-1.716-.902zm5.043-41.179c-.398-.339-1.27-.747-2.638.291-1.6 1.222-2.095 3.045-1.387 5.14.262.766.921 1.28 1.736 1.348.058.01.107.01.165.01.747 0 1.435-.417 1.785-1.086.911-1.717 1.619-4.626.339-5.703zm-2.046 4.801-.136.01c-.659-1.93.378-2.716.718-2.977.087-.068.155-.116.223-.155.048.591-.156 1.89-.805 3.122zm-14.955 41.79c-8.593-.272-16.041-4.82-16.962-10.358-.048-.291.029-.388.058-.427.592-.698 3.559-.727 6.43-.756.999-.01 2.075-.019 3.181-.058 5.266-.155 7.875-1.881 10.193-3.404a27.27 27.27 0 0 1 1.532-.98l-.97-1.678c-.553.32-1.086.669-1.639 1.038-2.192 1.445-4.461 2.948-9.175 3.084-1.096.039-2.153.048-3.142.058-4.054.039-6.731.068-7.894 1.455-.31.369-.65 1.018-.485 1.988 1.067 6.411 9.33 11.677 18.805 11.977h.504c4.869 0 11.017-2.202 13.238-6.449l-1.717-.902c-1.667 3.191-6.914 5.557-11.957 5.412zm35.117-39.54c-.485-.892-1.668-.941-3.462-1.028-.97-.039-2.056-.087-3.113-.272-1.726-.301-3.424-1.329-4.122-1.785-.165-1.445-.95-5.741-4.539-8.932C45.529.873 41.301-.31 36.006.068c-6.333.456-11.541 4.005-13.927 9.504-2.56 5.906-1.28 12.889 3.414 18.679 1.697 2.085 2.298 3.889 1.707 5.063-.65 1.319-2.822 2.066-5.664 1.959-5.644-.213-12.685-3.665-15.226-9.863l-.756-1.823-.98 1.707C-2.574 37.621.055 46.465 3.517 51.722 9.016 60.072 19.432 64 28.034 64a25.33 25.33 0 0 0 3.133-.184c9.776-1.183 17.505-5.596 20.677-11.803 2.366-4.636 2.075-9.883-.853-15.178-4.675-8.457-2.308-12.113-.941-13.364.213.039.427.078.65.097.301.029.621.048.95.048 2.89 0 7.07-1.222 11.909-6.343l.126-.165c.427-.707.252-1.25.116-1.512zm-14.508 22.17c2.599 4.713 2.88 9.33.824 13.364-2.88 5.635-10.057 9.65-19.183 10.755-8.467 1.028-20.037-2.502-25.797-11.231-3.017-4.567-5.315-12.151.222-22.771 3.443 6.11 10.542 9.116 16.109 9.33 3.714.126 6.44-.97 7.468-3.026.679-1.348.883-3.685-1.93-7.157-4.238-5.218-5.412-11.454-3.142-16.681 2.085-4.83 6.682-7.943 12.278-8.341 4.742-.339 8.486.669 11.124 3.007 2.968 2.628 3.714 6.265 3.889 7.584-6.663 4.791-6.682 7.128-6.061 8.088.485.766 1.503 1.61 2.88 2.192-1.649 2.105-3.269 6.585 1.319 14.887zm1.59-16.128c-2.24-.213-3.734-1.338-4.131-1.93-.068-.766 2.473-3.297 5.441-5.47.912.582 2.745 1.629 4.704 1.969 1.174.204 2.328.252 3.346.301.407.019.883.039 1.28.078-4.569 4.557-8.283 5.285-10.64 5.052zm-5.537-7.39c.912-1.717 1.62-4.626.339-5.703-.398-.339-1.27-.747-2.638.291-1.6 1.222-2.095 3.045-1.387 5.14.262.766.921 1.28 1.736 1.348.058.01.107.01.165.01.747 0 1.435-.417 1.785-1.086zm-1.707-.902-.136.01c-.659-1.93.378-2.716.718-2.977.087-.068.155-.116.223-.155.048.591-.156 1.89-.805 3.122zm-14.955 41.79c-8.593-.272-16.041-4.82-16.962-10.358-.048-.291.029-.388.058-.427.592-.698 3.559-.727 6.43-.756.999-.01 2.075-.019 3.181-.058 5.266-.155 7.875-1.881 10.193-3.404a27.27 27.27 0 0 1 1.532-.98l-.97-1.678c-.553.32-1.086.669-1.639 1.038-2.192 1.445-4.461 2.948-9.175 3.084-1.096.039-2.153.048-3.142.058-4.054.039-6.731.068-7.894 1.455-.31.369-.65 1.018-.485 1.988 1.067 6.411 9.33 11.677 18.805 11.977h.504c4.869 0 11.017-2.202 13.238-6.449l-1.717-.902c-1.667 3.191-6.914 5.557-11.957 5.412z"/><path style="fill:%23fed500" d="M49.293 37.766c-4.587-8.302-2.968-12.782-1.319-14.887-1.377-.582-2.395-1.426-2.88-2.192-.621-.96-.601-3.297 6.061-8.088-.175-1.319-.921-4.956-3.889-7.584-2.638-2.337-6.381-3.346-11.124-3.007-5.596.398-10.193 3.511-12.278 8.341-2.269 5.227-1.096 11.463 3.142 16.681 2.813 3.472 2.609 5.809 1.93 7.157-1.028 2.056-3.753 3.152-7.468 3.026-5.566-.213-12.666-3.22-16.109-9.33-5.538 10.62-3.239 18.204-.223 22.772 5.761 8.728 17.331 12.259 25.797 11.231 9.126-1.106 16.303-5.121 19.183-10.755 2.057-4.035 1.776-8.652-.823-13.365zM29.12 57.075h-.504c-9.475-.301-17.738-5.567-18.805-11.977-.165-.97.175-1.62.485-1.988 1.164-1.387 3.84-1.416 7.894-1.455.989-.01 2.046-.019 3.142-.058 4.713-.136 6.983-1.639 9.175-3.084a30.311 30.311 0 0 1 1.639-1.038l.97 1.678c-.514.301-1.018.63-1.532.98-2.318 1.523-4.927 3.249-10.193 3.404-1.106.039-2.182.048-3.181-.058-2.871.029-5.838.058-6.43.756-.029.039-.107.136-.058.427.921 5.538 8.37 10.086 16.962 10.358 5.043.145 10.29-2.221 11.958-5.412l1.717.902c-2.221 4.248-8.37 6.449-13.239 6.449zm14.276-41.751a1.975 1.975 0 0 1-1.736-1.348c-.708-2.095-.213-3.918 1.387-5.14 1.367-1.038 2.24-.63 2.638-.291 1.28 1.077.572 3.986-.339 5.703a2.015 2.015 0 0 1-1.785 1.086c-.058 0-.107 0-.165-.01z"/></svg>');
            background-size: contain;
            background-repeat: no-repeat;
            background-position: center;
            transition: transform 0.3s ease-in-out;
            image-rendering: pixelated;
            flex-shrink: 0;
        }

        @keyframes waddle {
            0% {
                transform: rotate(-5deg);
            }

            50% {
                transform: rotate(5deg);
            }

            100% {
                transform: rotate(-5deg);
            }
        }

        .duck-progress-bar .duck {
            animation: waddle 1s infinite ease-in-out;
        }

        .duck-button .duck-icon {
            width: 20px;
            height: 20px;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: scale(0.95);
            }

            to {
                opacity: 1;
                transform: scale(1);
            }
        }

        .animate-fade-in {
            animation: fadeIn 0.3s ease-out forwards;
        }

        @keyframes hint-glow {
            50% {
                box-shadow: 0 0 25px var(--accent-color), 0 0 35px var(--accent-color);
            }
        }

        .hint-glow {
            animation: hint-glow 1.5s infinite;
        }

        .mine-marker {
            position: absolute;
            transform: translateX(-50%);
            width: 40px;
            height: 40px;
            font-size: 30px;
            z-index: 5;
        }

        @keyframes pulse-mine {
            50% {
                transform: translateX(-50%) scale(1.3);
                opacity: 0.7;
            }
        }

        .mine-reveal {
            animation: pulse-mine 1s infinite;
        }

        .strategic-marker {
            position: absolute;
            transform: translateX(-50%);
            width: 24px;
            height: 24px;
            background-color: #ef4444; /* red-500 */
            border: 2px solid #ffffff; /* white */
            border-radius: 50%;
            z-index: 5;
            box-shadow: 0 0 15px rgba(239, 68, 68, 0.7); /* red glow */
            cursor: help;
            pointer-events: auto !important;
        }

        @keyframes pulse-strategic {
            50% {
                transform: translateX(-50%) scale(1.2);
                opacity: 1;
            }
        }

        .strategic-marker {
            animation: pulse-strategic 2s infinite ease-in-out;
        }

        .strategic-marker .tooltip {
            visibility: hidden;
            width: 140px;
            background-color: var(--text-primary);
            color: var(--bg-secondary);
            text-align: center;
            border-radius: 6px;
            padding: 5px 0;
            position: absolute;
            z-index: 10;
            bottom: 150%;
            left: 50%;
            margin-left: -70px;
            opacity: 0;
            transition: opacity 0.3s;
            font-size: 12px;
            font-family: 'Inter', sans-serif;
            pointer-events: none;
        }

        .strategic-marker:hover .tooltip {
            visibility: visible;
            opacity: 1;
        }
    </style>
</head>

<body class="flex items-center justify-center min-h-screen p-4">

    <div class="container mx-auto max-w-4xl">

        <!-- Setup Screen -->
        <div id="setup-screen" class="panel p-8 rounded-2xl shadow-xl space-y-6 max-w-lg mx-auto">
            <h1 class="text-4xl font-bold text-center flex items-center justify-center gap-2"
                style="color: var(--text-primary);">
                <span class="duck !w-12 !h-12"></span> Catch The Duck
            </h1>
            <p class="text-center" style="color: var(--text-secondary);">Set up your flock and challenge the bot or a
                friend!</p>

            <div id="stats-display" class="text-center p-3 rounded-lg" style="background-color: var(--bg-primary);">
                <h3 class="font-semibold text-sm uppercase tracking-wider" style="color: var(--text-secondary);">
                    Statistics</h3>
                <p id="stats-text" class="text-sm font-medium" style="color: var(--text-primary);"></p>
            </div>

            <div class="grid grid-cols-2 gap-4">
                <div>
                    <label for="game-mode" class="block text-sm font-medium mb-1">Game Mode</label>
                    <select id="game-mode"
                        class="w-full px-4 py-2 border rounded-lg focus:ring-2 transition"
                        style="background-color: var(--bg-secondary); border-color: var(--progress-bar-bg); color: var(--text-primary); focus-ring-color: var(--accent-color);">
                        <option value="bot">Player vs. Bot</option>
                        <option value="human">Player vs. Player</option>
                    </select>
                </div>
                <div>
                    <label for="special-mode" class="block text-sm font-medium mb-1">Special Mode</label>
                    <select id="special-mode"
                        class="w-full px-4 py-2 border rounded-lg focus:ring-2 transition"
                        style="background-color: var(--bg-secondary); border-color: var(--progress-bar-bg); color: var(--text-primary);">
                        <option value="classic">Classic</option>
                        <option value="mines">Crocodiles!</option>
                    </select>
                </div>
            </div>
            <div class="grid grid-cols-2 gap-4">
                <div>
                    <label for="theme-selector" class="block text-sm font-medium mb-1">Theme</label>
                    <select id="theme-selector"
                        class="w-full px-4 py-2 border rounded-lg focus:ring-2 transition"
                        style="background-color: var(--bg-secondary); border-color: var(--progress-bar-bg); color: var(--text-primary); focus-ring-color: var(--accent-color);">
                        <option value="light">Day Pond</option>
                        <option value="dark">Night Pond</option>
                        <option value="sunset">Sunset Pond</option>
                    </select>
                </div>
                <div>
                    <label for="target-number" class="block text-sm font-medium mb-1">Ducks to Catch (N)</label>
                    <input type="number" id="target-number" value="21"
                        class="w-full px-4 py-2 border rounded-lg focus:ring-2 transition"
                        style="background-color: var(--bg-primary); border-color: var(--progress-bar-bg); color: var(--text-primary);">
                </div>
            </div>

            <div>
                <label for="max-increase" class="block text-sm font-medium mb-1">Max Ducks per Turn (K)</label>
                <input type="number" id="max-increase" value="3"
                    class="w-full px-4 py-2 border rounded-lg focus:ring-2 transition"
                    style="background-color: var(--bg-primary); border-color: var(--progress-bar-bg); color: var(--text-primary);">
            </div>

            <div id="bot-settings">
                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <label for="player-start" class="block text-sm font-medium mb-1">Who Starts?</label>
                        <select id="player-start"
                            class="w-full px-4 py-2 border rounded-lg focus:ring-2 transition"
                            style="background-color: var(--bg-secondary); border-color: var(--progress-bar-bg); color: var(--text-primary);">
                            <option value="random">Random</option>
                            <option value="player">You</option>
                            <option value="bot">Bot</option>
                        </select>
                    </div>
                    <div>
                        <label for="difficulty" class="block text-sm font-medium mb-1">Bot Difficulty</label>
                        <select id="difficulty"
                            class="w-full px-4 py-2 border rounded-lg focus:ring-2 transition"
                            style="background-color: var(--bg-secondary); border-color: var(--progress-bar-bg); color: var(--text-primary);">
                            <option value="very-easy">Very Easy</option>
                            <option value="easy">Easy</option>
                            <option value="normal" selected>Normal</option>
                            <option value="hard">Hard</option>
                            <option value="impossible">Impossible</option>
                        </select>
                    </div>
                </div>
            </div>

            <button id="start-game-btn"
                class="w-full text-white font-bold py-3 px-4 rounded-lg focus:outline-none focus:ring-4 transition-transform transform hover:scale-105 btn"
                style="background-color: var(--accent-color);">Start Game</button>
        </div>

        <!-- Game Screen -->
        <div id="game-screen" class="hidden">
            <div class="lg:grid lg:grid-cols-3 lg:gap-6">

                <!-- Main Game Panel (Left/Top) -->
                <div class="lg:col-span-2">
                    <div class="panel p-6 md:p-8 rounded-2xl shadow-xl text-center">
                        <div class="flex justify-between items-start mb-4">
                            <div>
                                <p class="text-sm font-medium text-left" style="color: var(--text-secondary);">Target
                                </p>
                                <p id="target-display" class="text-2xl font-bold flex items-center gap-2"
                                    style="color: var(--accent-color);"></p>
                            </div>
                            <div class="flex gap-2">
                                <button id="hint-btn"
                                    class="btn text-white font-semibold py-2 px-4 rounded-lg disabled:opacity-50 disabled:cursor-not-allowed"
                                    style="background-color: var(--accent-color);">Hint (<span
                                        id="hints-left"></span>)</button>
                                <button id="undo-btn"
                                    class="btn font-semibold py-2 px-4 rounded-lg disabled:opacity-50 disabled:cursor-not-allowed"
                                    style="background-color: var(--progress-bar-bg); color: var(--text-primary);">Undo</button>
                                <button id="restart-btn"
                                    class="btn bg-red-500 text-white font-semibold py-2 px-4 rounded-lg hover:bg-red-600">Restart</button>
                            </div>
                        </div>

                        <div class="mb-6">
                            <p id="turn-indicator" class="text-lg font-semibold mb-2 h-6"></p>
                            <p id="current-ducks-display" class="text-2xl font-bold mb-2"></p>
                            <div id="pond-container" class="rounded-full overflow-hidden p-4 relative" style="background-color: var(--bg-primary);">
                                <div id="duck-progress-bar"
                                    class="flex flex-wrap gap-1 p-4 rounded-full overflow-hidden transition-all duration-500 ease-out"
                                    style="background-color: var(--water-color);">
                                    <!-- Ducks will be added here -->
                                </div>
                                <div id="mines-container" class="absolute inset-0 pointer-events-none"></div>
                                <div id="strategic-points-container" class="absolute inset-0"></div>
                            </div>
                        </div>

                        <div id="player-controls" class="mb-6">
                            <p class="font-medium mb-3">How many ducks to add?</p>
                            <div id="number-buttons" class="flex flex-wrap justify-center gap-3"></div>
                        </div>
                    </div>
                </div>

                <!-- Side Panels (Right/Bottom) -->
                <div class="space-y-4 mt-4 lg:mt-0">
                    <div id="strategy-panel" class="panel p-4 rounded-xl shadow-lg">
                        <h3 class="font-semibold mb-2 text-center">Strategy AI</h3>
                        <div id="strategy-content" class="text-sm space-y-2" style="color: var(--text-secondary);">
                            <p><strong>Status:</strong> <span id="strategy-status"></span></p>
                            <p id="strategy-explanation"></p>
                            <p><strong>Optimal Move:</strong> <span id="strategy-move"></span></p>
                            <div id="bot-thought-process" class="hidden pt-2 mt-2 border-t"
                                style="border-color: var(--progress-bar-bg);">
                                <p class="font-semibold text-sm" style="color: var(--text-primary);">Bot's Thought:</p>
                                <p id="bot-thought-text" class="italic"></p>
                            </div>
                        </div>
                    </div>
                    <div id="game-log-container" class="panel p-4 rounded-xl shadow-lg max-h-48 overflow-y-auto">
                        <h3 class="font-semibold mb-2 text-center">Game Log</h3>
                        <div id="game-log" class="text-sm text-center space-y-1"
                            style="color: var(--text-secondary);"></div>
                    </div>
                </div>

            </div>
        </div>

        <!-- Game Over Modal -->
        <div id="game-over-modal"
            class="hidden fixed inset-0 modal-backdrop flex items-center justify-center p-4 z-50">
            <div class="panel rounded-2xl shadow-xl p-8 text-center max-w-sm w-full animate-fade-in">
                <h2 id="modal-title" class="text-3xl font-bold mb-4"></h2>
                <p id="modal-message" class="mb-6" style="color: var(--text-secondary);"></p>
                <button id="play-again-btn"
                    class="w-full text-white font-bold py-3 px-4 rounded-lg focus:outline-none focus:ring-4 transition-transform transform hover:scale-105 btn"
                    style="background-color: var(--accent-color);">Play Again</button>
            </div>
        </div>
    </div>

    <script>
        // ===================================================================================
        // --- DOM Elements & Global State ---
        // ===================================================================================
        const setupScreen = document.getElementById('setup-screen');
        const gameScreen = document.getElementById('game-screen');
        const gameOverModal = document.getElementById('game-over-modal');
        const gameModeSelect = document.getElementById('game-mode');
        const specialModeSelect = document.getElementById('special-mode');
        const themeSelector = document.getElementById('theme-selector');
        const targetNumberInput = document.getElementById('target-number');
        const maxIncreaseInput = document.getElementById('max-increase');
        const difficultySelect = document.getElementById('difficulty');
        const playerStartSelect = document.getElementById('player-start');
        const startGameBtn = document.getElementById('start-game-btn');
        const playAgainBtn = document.getElementById('play-again-btn');
        const botSettingsDiv = document.getElementById('bot-settings');
        const statsText = document.getElementById('stats-text');
        const targetDisplay = document.getElementById('target-display');
        const pondContainer = document.getElementById('pond-container');
        const duckProgressBar = document.getElementById('duck-progress-bar');
        const turnIndicator = document.getElementById('turn-indicator');
        const currentDucksDisplay = document.getElementById('current-ducks-display');
        const numberButtonsContainer = document.getElementById('number-buttons');
        const gameLog = document.getElementById('game-log');
        const gameLogContainer = document.getElementById('game-log-container');
        const minesContainer = document.getElementById('mines-container');
        const strategicPointsContainer = document.getElementById('strategic-points-container');
        const undoBtn = document.getElementById('undo-btn');
        const restartBtn = document.getElementById('restart-btn');
        const hintBtn = document.getElementById('hint-btn');
        const hintsLeftSpan = document.getElementById('hints-left');
        const modalTitle = document.getElementById('modal-title');
        const modalMessage = document.getElementById('modal-message');
        const botThoughtProcess = document.getElementById('bot-thought-process');
        const botThoughtText = document.getElementById('bot-thought-text');

        // Game State
        let targetNumber, maxIncrease, difficulty, gameMode, specialMode;
        let currentNumber, isPlayerTurn, isGameOver, hintsLeft;
        let moveHistory = [];
        let mines = [];
        let strategicPoints = [];
        let ducksPerRow = 10; // Default, will be recalculated
        const DUCK_SIZE = 44; // Corresponds to the .duck class width/height in CSS
        const DUCK_GAP = 4; // Corresponds to gap-1 in Tailwind
        const POND_PADDING = 16; // Corresponds to p-4 in Tailwind


        let gameStats = {
            bot: { wins: 0, losses: 0 },
            human: { p1_wins: 0, p2_wins: 0 }
        };

        // Sound Engine
        const synth = new Tone.Synth().toDestination();
        const playSound = (note, duration = '8n') => {
            if (Tone.context.state !== 'running') {
                Tone.start();
            }
            synth.triggerAttackRelease(note, duration);
        }

        // ===================================================================================
        // --- Core Game Logic ---
        // ===================================================================================
        function startGame() {
            // 1. Get Settings
            targetNumber = parseInt(targetNumberInput.value);
            maxIncrease = parseInt(maxIncreaseInput.value);
            difficulty = difficultySelect.value;
            gameMode = gameModeSelect.value;
            specialMode = specialModeSelect.value;

            // 2. Validate Settings
            if (isNaN(targetNumber) || targetNumber <= 5 || isNaN(maxIncrease) || maxIncrease <= 0) {
                showModal("Invalid Settings", "Please enter a target number of ducks greater than 5 and a positive number for ducks per turn.");
                return;
            }
            if (maxIncrease >= targetNumber) {
                showModal("Invalid Settings", "Max ducks per turn must be smaller than the target number of ducks.");
                return;
            }

            // 3. Reset Game State
            currentNumber = 0;
            isGameOver = false;
            moveHistory = [0];
            hintsLeft = 3;
            mines = [];
            strategicPoints = [];
            
            // 4. Setup UI
            setupScreen.classList.add('hidden');
            gameScreen.classList.remove('hidden');
            botThoughtProcess.classList.add('hidden');
            
            // Calculate layout-dependent values after a brief delay to ensure the DOM is ready
            setTimeout(() => {
                const pondContentWidth = duckProgressBar.clientWidth - (POND_PADDING * 2);
                ducksPerRow = Math.floor(pondContentWidth / (DUCK_SIZE + DUCK_GAP));
                if(ducksPerRow <= 0) ducksPerRow = 1;

                const totalRows = Math.ceil(targetNumber / ducksPerRow);
                duckProgressBar.style.minHeight = `${(totalRows * (DUCK_SIZE + DUCK_GAP)) + POND_PADDING}px`;

                // Generate game elements that depend on layout
                if (specialMode === 'mines') generateMines();
                generateKeyPositionMarker();

                // 5. Initial Display & Controls Update
                updateDisplay();
            }, 0);


            targetDisplay.innerHTML = `${targetNumber} <span class="duck !w-8 !h-8"></span>`;
            gameLog.innerHTML = '';
            generatePlayerButtons();
            updateControlButtons();
            updateStrategyPanel();


            // 6. Determine Starting Turn
            isPlayerTurn = gameMode === 'bot' ?
                (playerStartSelect.value === 'player' ? true : (playerStartSelect.value === 'bot' ? false : Math
                    .random() < 0.5)) :
                true;

            if (gameMode === 'bot' && !isPlayerTurn) {
                togglePlayerButtons(false);
                setTimeout(botTurn, 1200);
            } else {
                togglePlayerButtons(true);
            }
        }
        
        function playerMove(amount) {
            if (isGameOver || (gameMode === 'bot' && !isPlayerTurn)) return;

            botThoughtProcess.classList.add('hidden');
            const prevNumber = currentNumber;
            currentNumber += amount;
            moveHistory.push(currentNumber);

            logAction(gameMode === 'bot' ? 'You' : (isPlayerTurn ? 'Player 1' : 'Player 2'), amount, prevNumber);

            if (checkEndConditions()) return;

            isPlayerTurn = !isPlayerTurn;
            updateDisplay();
            togglePlayerButtons(gameMode === 'human');
            updateControlButtons();
            updateStrategyPanel();


            if (gameMode === 'bot' && !isPlayerTurn) {
                setTimeout(botTurn, 1200);
            }
        }
        
        function botTurn() {
            if (isGameOver) return;
            const bestMove = getHardBotMove();
            let move;

            const randomChance = Math.random();
            switch (difficulty) {
                case 'very-easy':
                    move = getEasyBotMove();
                    break;
                case 'easy':
                    move = randomChance < 0.25 ? bestMove : getEasyBotMove();
                    break;
                case 'normal':
                    move = randomChance < 0.5 ? bestMove : getEasyBotMove();
                    break;
                case 'hard':
                    move = randomChance < 0.8 ? bestMove : getEasyBotMove();
                    break;
                case 'impossible':
                    move = bestMove;
                    break;
            }

            if (currentNumber + move > targetNumber) move = targetNumber - currentNumber;
            if (move <= 0) move = 1;

            // Bot "thinking" UI update
            botThoughtProcess.classList.remove('hidden');
            if (move === bestMove && getHardBotMove() !== getEasyBotMove()) {
                botThoughtText.textContent =
                    `I'm in a favorable position. The optimal move is to add ${move} to reach the next key number.`;
            } else if (difficulty === 'impossible') {
                botThoughtText.textContent = `My analysis shows that adding ${move} is the optimal path to victory.`;
            } else {
                botThoughtText.textContent =
                    `The position is unfavorable, so I'll make a random move by adding ${move} and hope for a mistake!`;
            }

            setTimeout(() => {
                const prevNumber = currentNumber;
                currentNumber += move;
                moveHistory.push(currentNumber);
                logAction('Bot', move, prevNumber);

                if (checkEndConditions()) return;

                isPlayerTurn = true;
                togglePlayerButtons(true);
                updateDisplay();
                updateControlButtons();
                updateStrategyPanel();
            }, 2000); // Increased delay to let user read the thought
        }

        const getEasyBotMove = () => {
            const possibleMoves = Array.from({
                length: maxIncrease
            }, (_, i) => i + 1).filter(m => currentNumber + m <= targetNumber && !mines.includes(
                currentNumber + m));
            return possibleMoves.length ? possibleMoves[Math.floor(Math.random() * possibleMoves.length)] : 1;
        };

        const getHardBotMove = () => {
            const strategicMod = maxIncrease + 1;
            const targetMod = targetNumber % strategicMod;

            // Look for a move that lands on a strategic point
            for (let move = 1; move <= maxIncrease; move++) {
                const nextNum = currentNumber + move;
                if (targetMod === 0) {
                     if (nextNum <= targetNumber && (nextNum % strategicMod === 0) && !mines.includes(nextNum)) {
                        return move;
                    }
                } else {
                    if (nextNum <= targetNumber && (nextNum % strategicMod === targetMod) && !mines.includes(
                        nextNum)) {
                        return move;
                    }
                }
            }
            // If no strategic move, return a "safe" random move
            return getEasyBotMove();
        };

        function checkEndConditions() {
            if (specialMode === 'mines' && mines.includes(currentNumber)) {
                isGameOver = true;
                revealMines();
                togglePlayerButtons(false);
                updateDisplay();

                const loserName = isPlayerTurn ? (gameMode === 'bot' ? 'You' : 'Player 1') : (gameMode ===
                    'bot' ? 'Bot' : 'Player 2');
                const winnerName = !isPlayerTurn ? (gameMode === 'bot' ? 'You' : 'Player 1') : (gameMode ===
                    'bot' ? 'Bot' : 'Player 2');

                showEndGameModal(winnerName.includes('You') || winnerName.includes('Player 1'), `OH NO!`,
                    `${loserName} ran into a crocodile! ${winnerName} wins!`);
                playSound('A2', '2n');

                if (gameMode === 'bot') {
                    updateStats(isPlayerTurn ? 'loss' : 'win');
                } else {
                    updateStats(isPlayerTurn ? 'p2' : 'p1');
                }
                return true;
            }

            if (currentNumber >= targetNumber) {
                isGameOver = true;
                revealMines();
                togglePlayerButtons(false);
                updateDisplay();
                let winner;

                if (gameMode === 'bot') {
                    winner = isPlayerTurn ? 'player' : 'bot';
                    updateStats(winner === 'player' ? 'win' : 'loss');
                } else {
                    winner = isPlayerTurn ? 'p1' : 'p2';
                    updateStats(winner);
                }

                if (currentNumber === targetNumber) {
                    const winnerName = winner === 'player' ? 'You' : (winner === 'p1' ? 'Player 1' : (
                        winner === 'p2' ? 'Player 2' : 'The Bot'));
                    const playerWon = winner === 'player' || winner === 'p1';
                    showEndGameModal(playerWon, `${winnerName} caught the last duck!`,
                        `A perfect catch! Well played!`);
                    if (playerWon) {
                        confetti({
                            particleCount: 150,
                            spread: 90,
                            origin: {
                                y: 0.6
                            }
                        });
                    }
                    playSound('C5', '4n');
                }
                return true;
            }
            return false;
        }

        function undoMove() {
            if (moveHistory.length <= 1) return;
            botThoughtProcess.classList.add('hidden');
            const stepsToUndo = gameMode === 'bot' ? 2 : 1;

            if (moveHistory.length > stepsToUndo) {
                for (let i = 0; i < stepsToUndo; i++) moveHistory.pop();
                currentNumber = moveHistory[moveHistory.length - 1];
            } else {
                moveHistory = [0];
                currentNumber = 0;
            }
            isPlayerTurn = true;
            logAction("System", "Move undone", currentNumber);
            updateDisplay();
            togglePlayerButtons(true);
            updateControlButtons();
            updateStrategyPanel();
        }

        // ===================================================================================
        // --- UI / DOM Manipulation ---
        // ===================================================================================
        function updateDisplay() {
            duckProgressBar.innerHTML = '';
            
            // Add current number display
            currentDucksDisplay.innerHTML = `Current Ducks: <span class="font-bold">${currentNumber}</span>`;

            for (let i = 0; i < currentNumber; i++) {
                const duck = document.createElement('div');
                duck.className = 'duck';
                duckProgressBar.appendChild(duck);
            }

            if (isGameOver) return;

            let turnText = "";
            if (gameMode === 'bot') {
                turnText = isPlayerTurn ? "Your Turn" : "Bot is thinking...";
            } else {
                turnText = isPlayerTurn ? "Player 1's Turn" : "Player 2's Turn";
            }
            turnIndicator.textContent = turnText;
            turnIndicator.style.color = isPlayerTurn ? 'var(--accent-color)' : 'var(--text-secondary)';
        }

        function getMarkerPosition(number) {
            if (ducksPerRow <= 0) return { top: '0px', left: '0px' };
            const DUCK_CELL_SIZE = DUCK_SIZE + DUCK_GAP;
            const duckIndex = number - 1;
            const row = Math.floor(duckIndex / ducksPerRow);
            const col = duckIndex % ducksPerRow;

            const top = POND_PADDING + (row * DUCK_CELL_SIZE) + DUCK_SIZE + 8;
            const left = POND_PADDING + (col * DUCK_CELL_SIZE) + (DUCK_SIZE / 2);
            
            return { top: `${top}px`, left: `${left}px` };
        }

        function generateMines() {
            minesContainer.innerHTML = '';
            const mineCount = Math.floor(targetNumber / 10) + 1;
            for (let i = 0; i < mineCount; i++) {
                let minePosition = Math.floor(Math.random() * (targetNumber - 5)) + 5;
                if (!mines.includes(minePosition)) {
                    mines.push(minePosition);
                    const marker = document.createElement('div');
                    marker.className = 'mine-marker';
                    marker.textContent = '🐊';
                    const pos = getMarkerPosition(minePosition);
                    marker.style.left = pos.left;
                    marker.style.top = pos.top;
                    minesContainer.appendChild(marker);
                } else {
                    i--; // Try again
                }
            }
        }
        
        function generateKeyPositionMarker() {
            strategicPointsContainer.innerHTML = '';
            strategicPoints = [];
            const strategicMod = maxIncrease + 1;
            const targetMod = targetNumber % strategicMod;

            // First, populate the array of all strategic points for the AI panel
            for (let i = 1; i < targetNumber; i++) {
                 if (targetMod === 0) {
                    if (i > 0 && i % strategicMod === 0) {
                        strategicPoints.push(i);
                    }
                } else {
                    if (i % strategicMod === targetMod) {
                        strategicPoints.push(i);
                    }
                }
            }

            // Then, find and draw only the LAST (highest) key position
            const keyPosition = Math.max(...strategicPoints);

            if (keyPosition > 0 && isFinite(keyPosition)) {
                 if (specialMode === 'mines' && mines.includes(keyPosition)) return;

                const marker = document.createElement('div');
                marker.className = 'strategic-marker';
                const pos = getMarkerPosition(keyPosition);
                marker.style.left = pos.left;
                marker.style.top = pos.top;

                const tooltip = document.createElement('span');
                tooltip.className = 'tooltip';
                tooltip.textContent = `Key Position: ${keyPosition}`;
                marker.appendChild(tooltip);

                strategicPointsContainer.appendChild(marker);
            }
        }

        function generatePlayerButtons() {
            numberButtonsContainer.innerHTML = '';
            for (let i = 1; i <= maxIncrease; i++) {
                const button = document.createElement('button');
                let duckIcons = '';
                for (let j = 0; j < i; j++) {
                    duckIcons += '<span class="duck duck-icon"></span>';
                }
                button.innerHTML = `+${i} ${duckIcons}`;
                button.dataset.increase = i;
                button.classList.add('btn', 'duck-button', 'text-white', 'font-bold', 'py-3', 'px-5',
                    'rounded-lg', 'shadow-md', 'flex', 'items-center', 'gap-2', 'disabled:opacity-50',
                    'disabled:cursor-not-allowed');
                button.style.backgroundColor = 'var(--accent-color)';
                button.addEventListener('click', () => {
                    playSound('C5', '16n');
                    playerMove(i);
                });
                numberButtonsContainer.appendChild(button);
            }
        }
        
        function updateControlButtons() {
            undoBtn.style.display = gameMode === 'bot' ? 'inline-flex' : 'none';
            undoBtn.disabled = moveHistory.length <= 1 || !isPlayerTurn;
            hintBtn.disabled = hintsLeft <= 0 || !isPlayerTurn || gameMode !== 'bot';
            hintsLeftSpan.textContent = hintsLeft;
        }

        function togglePlayerButtons(enabled) {
            numberButtonsContainer.querySelectorAll('button').forEach(button => {
                const increase = parseInt(button.dataset.increase);
                button.disabled = !enabled || (currentNumber + increase > targetNumber);
            });
        }
        
        function updateStrategyPanel() {
            const strategicMod = maxIncrease + 1;
            const targetMod = targetNumber % strategicMod;
            let isUnfavorable = false;

            if (targetMod === 0) {
                isUnfavorable = currentNumber > 0 && currentNumber % strategicMod === 0;
            } else {
                isUnfavorable = currentNumber % strategicMod === targetMod;
            }


            const statusEl = document.getElementById('strategy-status');
            const explanationEl = document.getElementById('strategy-explanation');
            const moveEl = document.getElementById('strategy-move');

            if (isUnfavorable) {
                statusEl.textContent = "Unfavorable Position";
                statusEl.style.color = '#ef4444'; // red-500
                explanationEl.textContent =
                    `Your opponent has forced you onto a key number. Any move you make will likely give them an advantage.`;
                moveEl.textContent = `No optimal move is available.`;
            } else {
                statusEl.textContent = "Favorable Position";
                statusEl.style.color = '#22c55e'; // green-500

                const optimalMove = getHardBotMove();
                const nextKeyNumber = currentNumber + optimalMove;

                if (optimalMove !== getEasyBotMove() || (nextKeyNumber % strategicMod === targetMod) || (targetMod === 0 && nextKeyNumber % strategicMod === 0)) {
                    explanationEl.textContent =
                        `The key is to land on numbers like ${strategicPoints.join(', ')}. The next key number is ${nextKeyNumber}.`;
                    moveEl.textContent = `Add ${optimalMove} to seize control.`;
                } else {
                    const moveForWin = targetNumber - currentNumber;
                    if (moveForWin > 0 && moveForWin <= maxIncrease) {
                        explanationEl.textContent = `You are in a position to win the game!`;
                        moveEl.textContent = `Add ${moveForWin} to land on ${targetNumber} and win!`;
                    } else {
                        explanationEl.textContent =
                            `You are in a good position, but cannot reach a key number in one move.`;
                        moveEl.textContent = `Any move is safe for now.`;
                    }
                }
            }
        }
        
        function showHint() {
            if (hintsLeft <= 0 || !isPlayerTurn || gameMode !== 'bot') return;

            hintsLeft--;
            const bestMove = getHardBotMove();
            const hintButton = numberButtonsContainer.querySelector(`[data-increase='${bestMove}']`);

            if (hintButton) {
                hintButton.classList.add('hint-glow');
                setTimeout(() => hintButton.classList.remove('hint-glow'), 1500);
            }
            updateControlButtons();
        }

        function revealMines() {
            if (specialMode !== 'mines') return;
            document.querySelectorAll('.mine-marker').forEach(marker => marker.classList.add('mine-reveal'));
        }

        function showEndGameModal(isWin, title, message) {
            modalTitle.textContent = title;
            modalMessage.textContent = message;
            modalTitle.style.color = isWin ? '#22c55e' : '#ef4444'; // green-500 or red-500
            gameOverModal.classList.remove('hidden');
        }

        function logAction(player, amount, prevNumber) {
            const p = document.createElement('p');
            if (player === 'System') {
                p.textContent = `System: Move undone. Back to ${currentNumber} ducks.`;
                p.classList.add('italic', 'text-gray-400');
            } else {
                p.innerHTML =
                    `${player} added ${amount} <span class="duck inline-block !w-4 !h-4"></span>. (${prevNumber} &rarr; ${currentNumber})`;
            }
            gameLog.appendChild(p);
            // Auto-scroll to the bottom
            gameLogContainer.scrollTop = gameLogContainer.scrollHeight;
        }

        function showModal(title, message) {
            modalTitle.textContent = title;
            modalMessage.textContent = message;
            modalTitle.style.color = '#ef4444'; // red-500
            playAgainBtn.textContent = 'Got it!';
            gameOverModal.classList.remove('hidden');

            const tempClickHandler = () => {
                gameOverModal.classList.add('hidden');
                playAgainBtn.textContent = 'Play Again';
                playAgainBtn.removeEventListener('click', tempClickHandler);
            };
            playAgainBtn.addEventListener('click', tempClickHandler);
        }

        // ===================================================================================
        // --- State Management & Utilities ---
        // ===================================================================================

        function initialize() {
            loadTheme();
            loadStats();
            updateStatsDisplay();
        }

        function resetGame() {
            gameOverModal.classList.add('hidden');
            gameScreen.classList.add('hidden');
            setupScreen.classList.remove('hidden');
            updateStatsDisplay();
        }
        
        function applyTheme(themeName) {
            document.body.className = `flex items-center justify-center min-h-screen p-4 theme-${themeName}`;
            localStorage.setItem('gameTheme', themeName);
            themeSelector.value = themeName;
        }

        function loadTheme() {
            const savedTheme = localStorage.getItem('gameTheme') || 'light';
            applyTheme(savedTheme);
        }

        function loadStats() {
            const savedStats = localStorage.getItem('gameStats');
            if (savedStats) gameStats = JSON.parse(savedStats);
        }

        function saveStats() {
            localStorage.setItem('gameStats', JSON.stringify(gameStats));
        }

        function updateStats(result) {
            if (gameMode === 'bot') {
                if (result === 'win') gameStats.bot.wins++;
                else gameStats.bot.losses++;
            } else {
                if (result === 'p1') gameStats.human.p1_wins++;
                else gameStats.human.p2_wins++;
            }
            saveStats();
        }

        function updateStatsDisplay() {
            statsText.innerHTML = `
                <span class="mr-4"><strong>vs Bot:</strong> ${gameStats.bot.wins}W - ${gameStats.bot.losses}L</span>
                <span><strong>vs Player:</strong> P1: ${gameStats.human.p1_wins}W - P2: ${gameStats.human.p2_wins}W</span>
            `;
        }

        // ===================================================================================
        // --- Initial Load & Event Listeners ---
        // ===================================================================================
        
        gameModeSelect.addEventListener('change', () => botSettingsDiv.style.display = gameModeSelect.value === 'bot' ?
            'block' : 'none');
        themeSelector.addEventListener('change', (e) => applyTheme(e.target.value));
        startGameBtn.addEventListener('click', () => {
            playSound('C4');
            startGame();
        });
        playAgainBtn.addEventListener('click', () => {
            playSound('C4');
            resetGame();
        });
        restartBtn.addEventListener('click', () => {
            playSound('E4');
            resetGame();
        });
        undoBtn.addEventListener('click', () => {
            playSound('A3');
            undoMove();
        });
        hintBtn.addEventListener('click', () => {
            playSound('G4');
            showHint();
        });

        // First time page load initialization
        initialize();
    </script>
</body>

</html>

